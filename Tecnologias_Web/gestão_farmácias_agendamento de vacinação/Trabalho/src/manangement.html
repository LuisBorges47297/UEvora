<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../styles/reset.css">
        <link rel="stylesheet" href="../styles/styles.css">
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <title>Vacinacao | Farmácias</title>
    </head>
    <body>
        <header>
            <nav>
                <h1><a href="index.html" class="logo"><img src="../public/assets/vacina.png" alt="logo" />Vacinação</a></h1>
                <ul>
                    <li><a href="search.html">Pesquisar</a></li>
                    <li><a href="farmacia.html">Farmácias</a></li>
                    <li><a href="agendar.html">Agendamentos</a></li>
                    <li><a href="manangement.html">Gestão</a></li>
                </ul>
            </nav>
        </header>
        <main>
            <button onclick="showFarmaciasCovid19()">Farmácias Covid-19</button>
            <button onclick="showFarmaciasGripe()">Farmácias Gripe</button>
            <button onclick="addFarmacia()">Adicionar Farmácias</button>
          

            <div id="result">

            </div>
        </main>
        <footer>
            <p>Jailson e Luis </p>
            <p>
                Mais informacao, consulte <a href="https://www.farmaciasportuguesas.pt/">https://www.farmaciasportuguesas.pt</a>
            </p>
        </footer>
    </body>
    <script>
        var formData = null;
        var data = null;

        function showFarmaciasCovid19(){
            const xMLHttpRequest = new XMLHttpRequest();
            xMLHttpRequest.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    const dados = JSON.parse(this.responseText);
                    showData(dados);
                }
            };
            xMLHttpRequest.open('POST', 'https://magno.di.uevora.pt/tweb/t1/farmacia/searchvaccine', true);
            xMLHttpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xMLHttpRequest.send("vaccine=covid-19");
        }

        function showFarmaciasGripe(){
            const xMLHttpRequest = new XMLHttpRequest();
            xMLHttpRequest.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    const dados = JSON.parse(this.responseText);
                    showData(dados);
                }
            };
            xMLHttpRequest.open('POST', 'https://magno.di.uevora.pt/tweb/t1/farmacia/searchvaccine', true);
            xMLHttpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xMLHttpRequest.send("vaccine=gripe");
        }

        function showData(response){
            data = response;

            document.getElementById("result").innerHTML = "";

            for(let farmacias of data.farmacias){
                document.getElementById("result").innerHTML +=
                "<li>" +
                "<h3>" + farmacias.name + "</h3>" +
                "<p> Codigo Postal/Localidade:" + farmacias.postal_code_locality + "</p>" +
                "<button onclick='showMoreInfo("+ farmacias.entity_id +")'>Mais informações</button>"+
                "</li>";
                
                
            }
        }

        function showMoreInfo(id){
            const xMLHttpRequest = new XMLHttpRequest();
            xMLHttpRequest.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                const dados = JSON.parse(this.responseText);
                console.log(dados.farmacia.email);
                document.getElementById("result").innerHTML = "";
                    document.getElementById("result").innerHTML =
                        "<h3>" + dados.farmacia.name + "</h3>" +
                        "<p> Entidade:" + dados.farmacia.entity_id + "</p>" +
                        "<p> Codigo Postal/Localidade:" + dados.farmacia.postal_code_locality + "</p>" +
                        "<p> Email:" + dados.farmacia.email + "</p>" +
                        "<p> Rua:" + dados.farmacia.street_name + "</p>" +
                        "<p> Telefone:" + dados.farmacia.telephone + "</p>" +

                        "<button onclick='deleteF("+ dados.farmacia.entity_id +")'>Apagar</button>"
                        console.log(dados);
                
                }
            };

            xMLHttpRequest.open('GET', 'https://magno.di.uevora.pt/tweb/t1/farmacia/get/'+id, true);
            xMLHttpRequest.send();	
        }

        function deleteF(entity_id){
            $.ajax({
                url: "https://magno.di.uevora.pt/tweb/t1/farmacia/delete",
                type: "DELETE",
                data: "entity_id=" + entity_id,
                success: function(response){
                   document.getElementById("result").innerHTML = "";
                   document.getElementById("result").innerHTML = "<p>  A Farmácia  foi apagada com sucesso</p>"
                }
                
            });
        }

        function addFarmacia(){
            document.getElementById("result").innerHTML = "";
            document.getElementById("result").innerHTML = 
            "<form id='form' action='https://magno.di.uevora.pt/tweb/t1/farmacia/add' method='PUT'>" +
            "<br><label for='name'>Nome:</label>" + "<br>"+
            "<input type='text' id='name' name='name' required>" + "<br>"+
            "<label for='entity_id'>Entidade:</label>" + "<br>"+
            "<input type='text' id='entity_id' name='entity_id' required>" + "<br>"+
            "<label for='postal_code_locality'>Codigo Postal/Localidade:</label>" + "<br>"+
            "<input type='text' id='postal_code_locality' name='postal_code_locality' required>" + "<br>"+
            "<label for='email'>Email:</label>" + "<br>"+
            "<input type='email' id='email' name='email' required>" + "<br>"+
            "<label for='street_name'>Rua:</label>" + "<br>"+
            "<input type='text' id='street_name' name='street_name' required>" + "<br>"+
            "<label for='telephone'>Telefone:</label>" + "<br>"+
            "<input type='text' id='telephone' name='telephone' required>" + "<br>"+
            "<input type='submit' value='Adicionar'>" + "<br>"+
            "</form>";
        }
    </script>
</html>
